name: "Pull Request Labeler"
on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  labeler:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Get list of commits
      id: commits
      run: echo "::set-output name=commits::$(git log --pretty=format:'%s' origin/${{ github.event.pull_request.base.ref }}..${{ github.event.pull_request.head.ref }} | tr '\n' ' ')"

    - name: Apply labels based on commit messages
      id: apply-labels
      run: |
        commits=${{ steps.commits.outputs.commits }}
        echo "Commits: $commits"
        labels=""
        for commit in $commits; do
          if [[ $commit == *"assets"* ]]; then
            labels="$labelsğŸ–Œï¸ assets,"
          fi
          if [[ $commit == *"breaking change"* ]]; then
            labels="$labelsğŸŠ breaking change,"
          fi
          if [[ $commit == *"bug"* ]]; then
            labels="$labelsğŸ bug,"
          fi
          if [[ $commit == *"build"* ]]; then
            labels="$labelsğŸ§± build,"
          fi
          if [[ $commit == *"chore"* ]]; then
            labels="$labelsğŸ§¹ chore,"
          fi
          if [[ $commit == *"ci"* ]]; then
            labels="$labelsğŸ¤– ci,"
          fi
          if [[ $commit == *"design"* ]]; then
            labels="$labelsğŸ¨ design,"
          fi
          if [[ $commit == *"docs"* ]]; then
            labels="$labelsğŸ““ documentation,"
          fi
          if [[ $commit == *"feature"* ]]; then
            labels="$labelsâœ¨ feature,"
          fi
          if [[ $commit == *"perf"* ]]; then
            labels="$labelsâš¡ performance,"
          fi
          if [[ $commit == *"refactor"* ]]; then
            labels="$labelsğŸ—ï¸ refactor,"
          fi
          if [[ $commit == *"remove"* ]]; then
            labels="$labelsğŸ—‘ï¸ remove,"
          fi
          if [[ $commit == *"rename"* ]]; then
            labels="$labelsâœï¸ rename,"
          fi
          if [[ $commit == *"style"* ]]; then
            labels="$labelsğŸ’ˆ style,"
          fi
        done
        labels=${labels%,} # Remove the trailing comma
        echo "Labels to apply: $labels"
        echo "::set-output name=labels::$labels"

    - name: Set PR labels
      uses: actions-ecosystem/action-add-labels@v1
      with:
        labels: ${{ steps.apply-labels.outputs.labels }}
        repo-token: ${{ secrets.GITHUB_TOKEN }}
